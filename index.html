<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reserva Cambio de Aceite</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
  body{background:linear-gradient(135deg,#0b5ed7,#121212);color:#e0e0e0;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:40px 10px;}
  .container{background:#1e1e1e;border-radius:15px;box-shadow:0 12px 30px rgba(0,0,0,0.8);padding:40px 30px;max-width:600px;width:100%;transition:all 0.3s ease;}
  h2{text-align:center;margin-bottom:30px;font-size:28px;color:#ffffff;text-shadow:0 2px 6px rgba(0,0,0,0.5);}
  .idiomas{text-align:right;margin-bottom:25px;}
  .idiomas img{width:30px;height:20px;cursor:pointer;margin-left:8px;border-radius:3px;border:1px solid #333;transition:transform 0.3s;}
  .idiomas img:hover{transform:scale(1.3);}
  .form-group{position:relative;margin-bottom:25px;}
  .form-group i{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:#888;font-size:16px;}
  .form-group input, .form-group select, .form-group textarea{
    width:100%;padding:14px 12px 14px 38px;border-radius:10px;border:none;background-color:#2a2a2a;color:#e0e0e0;font-size:15px;transition:all 0.3s ease, box-shadow 0.3s ease;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus{
    outline:none;background-color:#333;box-shadow:0 0 12px #0b5ed7;
  }
  .form-group textarea{min-height:80px;resize:vertical;}
  .form-group label{
    position:absolute;top:50%;left:38px;transform:translateY(-50%);
    pointer-events:none;color:#aaa;transition:0.3s;font-size:14px;background:#1e1e1e;padding:0 5px;
  }
  .form-group input:focus + label, .form-group input:not(:placeholder-shown) + label,
  .form-group select:focus + label, .form-group select:not([value=""]) + label,
  .form-group textarea:focus + label, .form-group textarea:not(:placeholder-shown) + label{
    top:-12px; left:10px; font-size:12px; color:#0b5ed7;
  }

  .agreement-container{margin-bottom:25px;text-align:left;background:#2a2a2a;padding:15px;border-radius:10px;box-shadow:inset 0 0 8px rgba(0,0,0,0.5);}
  .agreement-container label{font-size:14px;cursor:default;display:flex;align-items:center;opacity:0.8;transition:opacity 0.3s;}
  .agreement-container input{margin-right:12px;vertical-align:middle;cursor:not-allowed;transform:scale(1.2);}
  .agreement-container a{color:#0b5ed7;text-decoration:underline;font-size:13px;margin-top:5px;display:inline-block;}

  .firma-container{margin-bottom:25px;}
  .firma-container input{width:100%;padding:14px;border-radius:10px;border:none;background-color:#2a2a2a;color:#e0e0e0;font-size:15px;box-shadow:0 0 6px rgba(0,0,0,0.5);transition:box-shadow 0.3s ease;}
  .firma-container input:disabled{background-color:#3a3a3a;cursor:not-allowed;}
  .firma-container input:focus{box-shadow:0 0 12px #0b5ed7;}

  button{width:100%;padding:16px;background:linear-gradient(90deg,#0b5ed7,#084298);color:white;font-size:17px;border:none;border-radius:12px;cursor:pointer;font-weight:bold;transition:all 0.3s ease, transform 0.3s;}
  button:hover{background:linear-gradient(90deg,#084298,#0b5ed7);transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,0.7);}
  .mensaje{text-align:center;margin-top:20px;font-weight:bold;font-size:16px;opacity:0.9;}
  #recibo{display:none;background:#2a2a2a;margin-top:30px;padding:25px;border-radius:12px;color:#fff;box-shadow:0 8px 20px rgba(0,0,0,0.6);}
  #recibo h3{text-align:center;margin-bottom:20px;font-size:22px;}
  @media(max-width:600px){.container{padding:30px 20px;}h2{font-size:24px;}}
</style>
</head>
<body>
<div class="container">
  <div class="idiomas">
    <img src="https://flagcdn.com/16x12/es.png" alt="Español" onclick="setLang('es')">
    <img src="https://flagcdn.com/16x12/gb.png" alt="English" onclick="setLang('en')">
    <img src="https://flagcdn.com/16x12/pt.png" alt="Português" onclick="setLang('pt')">
  </div>
  <h2 id="titulo">Reserva de Servicio a Domicilio</h2>
  <form id="formCita">
    <div class="form-group"><i class="fas fa-user"></i><input type="text" name="Nombre" placeholder=" " required><label id="lblNombre">Nombre completo</label></div>
    <div class="form-group"><i class="fas fa-phone"></i><input type="tel" name="Telefono" placeholder=" " required><label id="lblTelefono">Teléfono</label></div>
    <div class="form-group"><i class="fas fa-envelope"></i><input type="email" name="Correo" placeholder=" " required><label id="lblCorreo">Correo electrónico</label></div>
    <div class="form-group"><i class="fas fa-car"></i><input type="text" name="Marca" placeholder=" "><label id="lblMarca">Marca del vehículo</label></div>
    <div class="form-group"><i class="fas fa-car-side"></i><input type="text" name="Modelo" placeholder=" "><label id="lblModelo">Modelo del vehículo</label></div>
    <div class="form-group"><i class="fas fa-calendar-alt"></i><input type="number" name="Ano" placeholder=" "><label id="lblAno">Año del vehículo</label></div>

    <div class="form-group"><i class="fas fa-oil-can"></i>
      <select name="TipoAceite" id="selectTipoAceite" required>
        <option value="">Selecciona tipo de aceite</option>
        <option value="0W20">0W20</option>
        <option value="0W30">0W30</option>
        <option value="5W20">5W20</option>
        <option value="5W30">5W30</option>
      </select>
      <label id="lblAceite">Tipo de Aceite</label>
    </div>

    <div class="form-group"><i class="fas fa-oil-can"></i>
      <select name="Marca" id="selectMarca" required>
        <option value="">Selecciona marca de aceite</option>
      </select>
      <label id="lblMarcaAceite">Marca de Aceite</label>
    </div>

    <div class="form-group">
      <textarea id="descripcionAceite" readonly placeholder="Descripción del aceite seleccionado"></textarea>
    </div>

    <div class="form-group"><i class="fas fa-map-marker-alt"></i><input type="text" name="Direccion" placeholder=" " required><label id="lblDireccion">Dirección del servicio</label></div>
    <div class="form-group"><i class="fas fa-calendar-day"></i><input type="date" name="Fecha" placeholder=" " required><label id="lblFecha">Fecha</label></div>
    <div class="form-group"><i class="fas fa-clock"></i><input type="time" name="Hora" placeholder=" " required><label id="lblHora">Hora</label></div>
    <div class="form-group"><i class="fas fa-comment-dots"></i><textarea name="Comentarios" placeholder=" "></textarea><label id="lblComentarios">Comentarios adicionales</label></div>

    <div class="agreement-container">
      <label>
        <input type="checkbox" id="chkAgreement" disabled>
        <span id="acuerdoTexto">Debes leer y aceptar el acuerdo antes de poder firmar.</span>
      </label>
      <a href="acuerdo.html" target="_blank" id="linkAcuerdo">Leer acuerdo completo</a>
      <button type="button" id="btnAceptarAcuerdo" style="margin-top:10px;width:100%;padding:10px;background:#0b5ed7;color:white;border:none;border-radius:8px;cursor:pointer;">He leído y acepto el acuerdo</button>
    </div>

    <div class="firma-container">
      <input type="text" name="Firma" placeholder="Escribe tu nombre como firma digital" required disabled>
    </div>

    <input type="hidden" name="Estado" value="Pendiente">
    <input type="hidden" id="langField" name="Idioma">
    <button type="submit" id="btnEnviar">Enviar Reserva</button>
  </form>

  <div class="mensaje" id="mensaje"></div>

  <div id="recibo">
    <h3 id="reciboTitulo">✅ Recibo de Reserva</h3>
    <p><b>Nombre:</b> <span id="reciboNombre"></span></p>
    <p><b>Teléfono:</b> <span id="reciboTelefono"></span></p>
    <p><b>Correo:</b> <span id="reciboCorreo"></span></p>
    <p><b>Marca:</b> <span id="reciboMarca"></span></p>
    <p><b>Modelo:</b> <span id="reciboModelo"></span></p>
    <p><b>Año:</b> <span id="reciboAno"></span></p>
    <p><b>Tipo de Aceite:</b> <span id="reciboAceite"></span></p>
    <p><b>Dirección:</b> <span id="reciboDireccion"></span></p>
    <p><b>Fecha del Servicio:</b> <span id="reciboFecha"></span></p>
    <p><b>Hora del Servicio:</b> <span id="reciboHora"></span></p>
    <p><b>Comentarios:</b> <span id="reciboComentarios"></span></p>
    <p><b>Firma:</b> <span id="reciboFirma"></span></p>
  </div>
</div>

<script>
// === Traducciones ===
const translations = {
  es:{titulo:"Reserva de Servicio a Domicilio", enviar:"Enviar Reserva", exito:"✅ Tu cita ha sido registrada correctamente", error24:"❌ La cita debe agendarse con al menos 24 horas de anticipación", acuerdo:"Debes aceptar el acuerdo antes de enviar la cita.", recibo:"✅ Recibo de Reserva", link:"Leer acuerdo completo"},
  en:{titulo:"Home Service Booking", enviar:"Submit Booking", exito:"✅ Your appointment has been successfully booked", error24:"❌ Appointments must be scheduled at least 24 hours in advance", acuerdo:"You must accept the agreement before submitting the booking.", recibo:"✅ Booking Receipt", link:"Read full agreement"},
  pt:{titulo:"Agendamento de Serviço Domiciliar", enviar:"Enviar Reserva", exito:"✅ Sua reserva foi registrada com sucesso", error24:"❌ As reservas devem ser feitas com pelo menos 24 horas de antecedência", acuerdo:"Você deve aceitar o acordo antes de enviar a reserva.", recibo:"✅ Recibo de Reserva", link:"Ler o acordo completo"}
};
let lang = navigator.language.slice(0,2);
if(!translations[lang]) lang='es';
applyLang(lang);
function setLang(l){lang=l;applyLang(lang);}
function applyLang(lang){
  const t=translations[lang];
  document.getElementById('titulo').innerText=t.titulo;
  document.getElementById('btnEnviar').innerText=t.enviar;
  document.getElementById('acuerdoTexto').innerText=t.acuerdo;
  document.getElementById('reciboTitulo').innerText=t.recibo;
  document.getElementById('linkAcuerdo').innerText=t.link;
  document.getElementById('langField').value=lang;
}

// === Checkbox y Firma ===
const chkAgreement = document.getElementById('chkAgreement');
const btnAceptarAcuerdo = document.getElementById('btnAceptarAcuerdo');
const firmaInput = document.querySelector('.firma-container input');

btnAceptarAcuerdo.addEventListener('click',()=>{
  localStorage.setItem('acuerdoFirmado','true');
  chkAgreement.checked = true;
  chkAgreement.disabled = true;
  firmaInput.disabled = false;
  document.getElementById('acuerdoTexto').textContent = "✅ Acuerdo aceptado correctamente.";
  btnAceptarAcuerdo.style.display='none';
});

// === Aceites ===
const aceitesData = [
  {Tipo:"0W20", Marca:"Mobil 1", Descripcion:"Aceite sintético total, excelente protección y limpieza del motor.", Precio:25},
  {Tipo:"0W20", Marca:"Pennzoil", Descripcion:"Aceite sintético con limpieza activa, ideal para motores modernos.", Precio:24},
  {Tipo:"0W20", Marca:"Valvoline", Descripcion:"Protección avanzada contra el desgaste, buen rendimiento en frío.", Precio:27},
  {Tipo:"0W30", Marca:"Mobil 1", Descripcion:"Totalmente sintético, excelente viscosidad en climas fríos.", Precio:25},
  {Tipo:"0W30", Marca:"Pennzoil", Descripcion:"Reduce la fricción interna del motor y mejora la eficiencia.", Precio:25},
  {Tipo:"0W30", Marca:"Valvoline", Descripcion:"Formulado para máxima protección en motores exigentes.", Precio:27},
  {Tipo:"5W20", Marca:"Mobil 1", Descripcion:"Tecnología avanzada anti-desgaste, rendimiento óptimo.", Precio:25},
  {Tipo:"5W20", Marca:"Pennzoil", Descripcion:"Mantiene el motor limpio y eficiente, buena resistencia térmica.", Precio:24},
  {Tipo:"5W20", Marca:"Valvoline", Descripcion:"Buena durabilidad del motor, ideal para condiciones mixtas.", Precio:26},
  {Tipo:"5W30", Marca:"Mobil 1", Descripcion:"Excelente control de oxidación y protección del motor.", Precio:26},
  {Tipo:"5W30", Marca:"Pennzoil", Descripcion:"Alta limpieza y fluidez a bajas temperaturas.", Precio:25},
  {Tipo:"5W30", Marca:"Valvoline", Descripcion:"Aceite duradero con aditivos anti-desgaste avanzados.", Precio:27},
];
const selectTipo = document.getElementById('selectTipoAceite');
const selectMarca = document.getElementById('selectMarca');
const descArea = document.getElementById('descripcionAceite');

selectTipo.addEventListener('change',()=>{
  const tipo = selectTipo.value;
  selectMarca.innerHTML='<option value="">Selecciona marca de aceite</option>';
  descArea.value="";
  if(!tipo) return;
  const marcas = aceitesData.filter(a=>a.Tipo===tipo).map(a=>a.Marca);
  marcas.forEach(m=>{
    const opt=document.createElement('option');
    opt.value=m;
    opt.textContent=m;
    selectMarca.appendChild(opt);
  });
});
selectMarca.addEventListener('change',()=>{
  const tipo = selectTipo.value;
  const marca = selectMarca.value;
  const aceite = aceitesData.find(a=>a.Tipo===tipo && a.Marca===marca);
  descArea.value = aceite ? aceite.Descripcion : "";
});

// === Envío Formulario ===
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw1Odn29AKsvgYwgnTpg3dNWczFmzj_fxQWpHQ2451W62eCgFf8Oqfu8CVo8RPYM8ygnw/exec"; 
document.getElementById('formCita').addEventListener('submit', function(e){
  e.preventDefault();
  const form=this;
  const msg=document.getElementById('mensaje');
  msg.textContent="⏳ Enviando...";

  if(localStorage.getItem('acuerdoFirmado')!=='true'){
    msg.textContent = translations[lang].acuerdo;
    return;
  }

  const data=Object.fromEntries(new FormData(form).entries());
  const now=new Date();
  const selected=new Date(data.Fecha+"T"+data.Hora);
  if(!data.Fecha || !data.Hora || selected-now<24*60*60*1000){
    msg.textContent=translations[lang].error24;
    return;
  }

  const aceiteSel=aceitesData.find(a=>a.Tipo===data.TipoAceite && a.Marca===data.Marca);
  if(aceiteSel) data.PrecioAceite=aceiteSel.Precio;

  fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify(data)})
    .then(r=>r.json())
    .then(r=>{
      if(r.result==="success"){
        msg.textContent=translations[lang].exito;
        document.getElementById('reciboNombre').textContent=data.Nombre;
        document.getElementById('reciboTelefono').textContent=data.Telefono;
        document.getElementById('reciboCorreo').textContent=data.Correo;
        document.getElementById('reciboMarca').textContent=data.Marca;
        document.getElementById('reciboModelo').textContent=data.Modelo;
        document.getElementById('reciboAno').textContent=data.Ano;
        document.getElementById('reciboAceite').textContent=data.TipoAceite+" "+data.Marca;
        document.getElementById('reciboDireccion').textContent=data.Direccion;
        document.getElementById('reciboFecha').textContent=data.Fecha;
        document.getElementById('reciboHora').textContent=data.Hora;
        document.getElementById('reciboComentarios').textContent=data.Comentarios;
        document.getElementById('reciboFirma').textContent=data.Firma;
        document.getElementById('recibo').style.display='block';
        form.reset();
        chkAgreement.checked=false;
        firmaInput.disabled=true;
        btnAceptarAcuerdo.style.display='block';
      }else msg.textContent="❌ Error al enviar la cita.";
    }).catch(e=>{msg.textContent="❌ Error de conexión.";console.error(e);});
});
</script>
</body>
</html>
