<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reserva Cambio de Aceite</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
  body{background-color:#121212;color:#e0e0e0;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:40px 10px;}
  .container{background:#1e1e1e;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.7);padding:40px 30px;max-width:600px;width:100%;}
  h2{text-align:center;margin-bottom:30px;font-size:28px;color:#ffffff;}
  .idiomas{text-align:right;margin-bottom:25px;}
  .idiomas img{width:30px;height:20px;cursor:pointer;margin-left:8px;border-radius:3px;border:1px solid #333;transition:transform 0.2s;}
  .idiomas img:hover{transform:scale(1.2);}
  .form-group{position:relative;margin-bottom:25px;}
  .form-group i{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:#888;font-size:16px;}
  .form-group input, .form-group select, .form-group textarea{
    width:100%;padding:14px 12px 14px 38px;border-radius:8px;border:none;background-color:#2a2a2a;color:#e0e0e0;font-size:15px;transition:all 0.3s ease;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus{
    outline:none;background-color:#333;box-shadow:0 0 8px #0b5ed7;
  }
  .form-group textarea{min-height:80px;resize:vertical;}
  .form-group label{
    position:absolute;top:50%;left:38px;transform:translateY(-50%);
    pointer-events:none;color:#aaa;transition:0.3s;font-size:14px;background:#1e1e1e;padding:0 5px;
  }
  .form-group input:focus + label, .form-group input:not(:placeholder-shown) + label,
  .form-group select:focus + label, .form-group select:not([value=""]) + label,
  .form-group textarea:focus + label, .form-group textarea:not(:placeholder-shown) + label{
    top:-10px; left:10px; font-size:12px; color:#0b5ed7;
  }
  .agreement-container{margin-bottom:20px;text-align:left;}
  .agreement-container a{color:#0b5ed7;text-decoration:underline;font-size:13px;display:inline-block;margin-top:5px;cursor:pointer;}
  .firma-container{margin-bottom:20px;}
  .firma-container input{width:100%;padding:10px;border-radius:8px;border:none;background-color:#2a2a2a;color:#e0e0e0;font-size:15px;}
  button[type="submit"]{width:100%;padding:15px;background:linear-gradient(90deg,#0b5ed7,#084298);color:white;font-size:17px;border:none;border-radius:10px;cursor:pointer;font-weight:bold;transition:all 0.3s ease;}
  button[type="submit"]:hover{background:linear-gradient(90deg,#084298,#0b5ed7);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.6);}
  .mensaje{text-align:center;margin-top:20px;font-weight:bold;font-size:16px;}
  #recibo{display:none;background:#2a2a2a;margin-top:30px;padding:20px;border-radius:10px;color:#fff;}
  #recibo h3{text-align:center;margin-bottom:20px;}
  /* Modal */
  .modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.8);}
  .modal-content{background:#1e1e1e;margin:50px auto;padding:20px;border-radius:12px;width:90%;max-width:700px;color:#e0e0e0;max-height:80vh;overflow-y:auto;}
  .modal-content h2{text-align:center;margin-bottom:15px;color:#fff;}
  .modal-content p, .modal-content ul{margin-bottom:12px;line-height:1.6;}
  .modal-content ul{margin-left:20px;}
  .modal-close{float:right;font-size:24px;color:#888;cursor:pointer;transition:color 0.2s;}
  .modal-close:hover{color:#fff;}
  .modal-accept{display:block;margin:20px auto 0;padding:12px 25px;background:linear-gradient(90deg,#0b5ed7,#084298);color:white;font-size:16px;border:none;border-radius:10px;cursor:pointer;font-weight:bold;transition:all 0.3s ease;}
  .modal-accept:hover{background:linear-gradient(90deg,#084298,#0b5ed7);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.6);}
  @media(max-width:600px){.container{padding:30px 20px;}h2{font-size:24px;}}
</style>
</head>
<body>
<div class="container">
  <div class="idiomas">
    <img src="https://flagcdn.com/16x12/es.png" alt="Espa√±ol" onclick="setLang('es')">
    <img src="https://flagcdn.com/16x12/gb.png" alt="English" onclick="setLang('en')">
    <img src="https://flagcdn.com/16x12/pt.png" alt="Portugu√™s" onclick="setLang('pt')">
  </div>
  <h2 id="titulo">Reserva de Servicio a Domicilio</h2>
  <form id="formCita">
    <div class="form-group"><i class="fas fa-user"></i><input type="text" name="Nombre" placeholder=" " required><label id="lblNombre">Nombre completo</label></div>
    <div class="form-group"><i class="fas fa-phone"></i><input type="tel" name="Telefono" placeholder=" " required><label id="lblTelefono">Tel√©fono</label></div>
    <div class="form-group"><i class="fas fa-envelope"></i><input type="email" name="Correo" placeholder=" " required><label id="lblCorreo">Correo electr√≥nico</label></div>
    <div class="form-group"><i class="fas fa-car"></i><input type="text" name="Marca" placeholder=" "><label id="lblMarca">Marca del veh√≠culo</label></div>
    <div class="form-group"><i class="fas fa-car-side"></i><input type="text" name="Modelo" placeholder=" "><label id="lblModelo">Modelo del veh√≠culo</label></div>
    <div class="form-group"><i class="fas fa-calendar-alt"></i><input type="number" name="Ano" placeholder=" "><label id="lblAno">A√±o del veh√≠culo</label></div>

    <div class="form-group"><i class="fas fa-oil-can"></i>
      <select name="TipoAceite" id="selectTipoAceite" required>
        <option value="">Selecciona tipo de aceite</option>
        <option value="0W20">0W20</option>
        <option value="0W30">0W30</option>
        <option value="5W20">5W20</option>
        <option value="5W30">5W30</option>
      </select>
      <label id="lblAceite">Tipo de Aceite</label>
    </div>

    <div class="form-group"><i class="fas fa-oil-can"></i>
      <select name="Marca" id="selectMarca" required>
        <option value="">Selecciona marca de aceite</option>
      </select>
      <label id="lblMarcaAceite">Marca de Aceite</label>
    </div>

    <div class="form-group">
      <textarea id="descripcionAceite" readonly placeholder="Descripci√≥n del aceite seleccionado"></textarea>
    </div>

    <div class="form-group"><i class="fas fa-map-marker-alt"></i><input type="text" name="Direccion" placeholder=" " required><label id="lblDireccion">Direcci√≥n del servicio</label></div>
    <div class="form-group"><i class="fas fa-calendar-day"></i><input type="date" name="Fecha" placeholder=" " required><label id="lblFecha">Fecha</label></div>
    <div class="form-group"><i class="fas fa-clock"></i><input type="time" name="Hora" placeholder=" " required><label id="lblHora">Hora</label></div>
    <div class="form-group"><i class="fas fa-comment-dots"></i><textarea name="Comentarios" placeholder=" "></textarea><label id="lblComentarios">Comentarios adicionales</label></div>

    <div class="agreement-container">
      <a id="linkAcuerdo">Leer acuerdo completo</a>
    </div>

    <div class="firma-container">
      <input type="text" name="Firma" id="firmaInput" placeholder="Escribe tu nombre como firma digital" disabled required>
    </div>

    <input type="hidden" name="Estado" value="Pendiente">
    <input type="hidden" id="langField" name="Idioma">
    <button type="submit" id="btnEnviar">Enviar Reserva</button>
  </form>

  <div class="mensaje" id="mensaje"></div>

  <div id="recibo">
    <h3 id="reciboTitulo">‚úÖ Recibo de Reserva</h3>
    <p><b>Nombre:</b> <span id="reciboNombre"></span></p>
    <p><b>Tel√©fono:</b> <span id="reciboTelefono"></span></p>
    <p><b>Correo:</b> <span id="reciboCorreo"></span></p>
    <p><b>Marca:</b> <span id="reciboMarca"></span></p>
    <p><b>Modelo:</b> <span id="reciboModelo"></span></p>
    <p><b>A√±o:</b> <span id="reciboAno"></span></p>
    <p><b>Tipo de Aceite:</b> <span id="reciboAceite"></span></p>
    <p><b>Direcci√≥n:</b> <span id="reciboDireccion"></span></p>
    <p><b>Fecha del Servicio:</b> <span id="reciboFecha"></span></p>
    <p><b>Hora del Servicio:</b> <span id="reciboHora"></span></p>
    <p><b>Comentarios:</b> <span id="reciboComentarios"></span></p>
    <p><b>Firma:</b> <span id="reciboFirma"></span></p>
  </div>
</div>

<!-- Modal del acuerdo -->
<div id="modalAcuerdo" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Acuerdo de Servicio a Domicilio</h2>
    <div id="textoAcuerdo"></div>
    <button class="modal-accept">Aceptar y firmar acuerdo ‚úÖ</button>
  </div>
</div>

<script>
// üåê Textos del acuerdo seg√∫n idioma
const acuerdoText = {
  es: `<p>Al solicitar nuestro servicio de cambio de aceite a domicilio, usted acepta los siguientes t√©rminos y condiciones:</p><ul><li>El cliente debe proporcionar informaci√≥n veraz sobre el veh√≠culo y la ubicaci√≥n del servicio.</li><li>Se requiere agendar la cita con al menos 24 horas de anticipaci√≥n.</li><li>El t√©cnico tiene derecho a reprogramar la cita en caso de condiciones clim√°ticas adversas o emergencias.</li><li>Los precios pueden variar seg√∫n el tipo de aceite, filtro y servicio adicional solicitado.</li><li>El cliente es responsable de asegurar el acceso adecuado al veh√≠culo durante el servicio.</li><li>Todos los pagos deben completarse al finalizar el servicio.</li><li>El cliente acepta que la firma digital en este formulario es vinculante para aceptar los t√©rminos.</li></ul><p>Lea cuidadosamente estos t√©rminos antes de aceptar. Al hacer clic en "Aceptar y firmar acuerdo", confirma que ha le√≠do, entendido y acepta estas condiciones.</p>`,
  en: `<p>By requesting our home oil change service, you agree to the following terms and conditions:</p><ul><li>The client must provide accurate information about the vehicle and service location.</li><li>Appointments must be scheduled at least 24 hours in advance.</li><li>The technician reserves the right to reschedule in case of adverse weather or emergencies.</li><li>Prices may vary depending on the type of oil, filter, and additional services requested.</li><li>The client is responsible for ensuring proper access to the vehicle during service.</li><li>All payments must be completed upon service completion.</li><li>The client agrees that the digital signature on this form is binding to accept the terms.</li></ul><p>Read these terms carefully before accepting. By clicking "Accept and sign agreement," you confirm you have read, understood, and agree to these conditions.</p>`,
  pt: `<p>Ao solicitar nosso servi√ßo domiciliar de troca de √≥leo, voc√™ concorda com os seguintes termos e condi√ß√µes:</p><ul><li>O cliente deve fornecer informa√ß√µes precisas sobre o ve√≠culo e o local do servi√ßo.</li><li>As reservas devem ser feitas com pelo menos 24 horas de anteced√™ncia.</li><li>O t√©cnico reserva-se o direito de reagendar em caso de clima adverso ou emerg√™ncias.</li><li>Os pre√ßos podem variar dependendo do tipo de √≥leo, filtro e servi√ßos adicionais solicitados.</li><li>O cliente √© respons√°vel por garantir o acesso adequado ao ve√≠culo durante o servi√ßo.</li><li>Todos os pagamentos devem ser conclu√≠dos ap√≥s a conclus√£o do servi√ßo.</li><li>O cliente concorda que a assinatura digital neste formul√°rio √© vinculativa para aceitar os termos.</li></ul><p>Leia atentamente estes termos antes de aceitar. Ao clicar em "Aceitar e assinar acordo", voc√™ confirma que leu, entendeu e concorda com estas condi√ß√µes.</p>`
};

// Idioma
let lang = navigator.language.slice(0,2);
if(!['es','en','pt'].includes(lang)) lang='es';
applyLang(lang);

function setLang(l){lang=l;applyLang(lang);}
function applyLang(lang){
  document.getElementById('titulo').innerText = {'es':'Reserva de Servicio a Domicilio','en':'Home Service Booking','pt':'Agendamento de Servi√ßo Domiciliar'}[lang];
  document.getElementById('btnEnviar').innerText = {'es':'Enviar Reserva','en':'Submit Booking','pt':'Enviar Reserva'}[lang];
  document.getElementById('langField').value = lang;
  document.getElementById('textoAcuerdo').innerHTML = acuerdoText[lang];
}

// Modal
const modal = document.getElementById('modalAcuerdo');
const link = document.getElementById('linkAcuerdo');
const spanClose = document.querySelector('.modal-close');
const btnAceptar = document.querySelector('.modal-accept');
const firmaInput = document.getElementById('firmaInput');

link.onclick = ()=>{modal.style.display='block';}
spanClose.onclick = ()=>{modal.style.display='none';}
window.onclick = (e)=>{if(e.target==modal) modal.style.display='none';}

// Aceptar acuerdo
btnAceptar.onclick = ()=>{
  firmaInput.disabled=false;
  localStorage.setItem('acuerdoFirmado','true');
  modal.style.display='none';
  alert({'es':'‚úÖ Acuerdo aceptado. Ahora puede firmar su reserva.','en':'‚úÖ Agreement accepted. You can now sign your booking.','pt':'‚úÖ Acordo aceito. Agora voc√™ pode assinar sua reserva.'}[lang]);
}

// Desbloquear si ya acept√≥ antes
window.addEventListener('load', ()=>{if(localStorage.getItem('acuerdoFirmado')==='true'){firmaInput.disabled=false;}});

// --- Aqu√≠ contin√∫a todo tu c√≥digo existente para aceites y env√≠o de formulario ---
const aceitesData = [
  {Tipo:"0W20", Marca:"Mobil 1", Descripcion:"Aceite sint√©tico total, excelente protecci√≥n y limpieza del motor.", Precio:25},
  {Tipo:"0W20", Marca:"Pennzoil", Descripcion:"Aceite sint√©tico con limpieza activa, ideal para motores modernos.", Precio:24},
  {Tipo:"0W20", Marca:"Valvoline", Descripcion:"Protecci√≥n avanzada contra el desgaste, buen rendimiento en fr√≠o.", Precio:27},
  {Tipo:"0W30", Marca:"Mobil 1", Descripcion:"Totalmente sint√©tico, excelente viscosidad en climas fr√≠os.", Precio:25},
  {Tipo:"0W30", Marca:"Pennzoil", Descripcion:"Reduce la fricci√≥n interna del motor y mejora la eficiencia.", Precio:25},
  {Tipo:"0W30", Marca:"Valvoline", Descripcion:"Formulado para m√°xima protecci√≥n en motores exigentes.", Precio:27},
  {Tipo:"5W20", Marca:"Mobil 1", Descripcion:"Tecnolog√≠a avanzada anti-desgaste, rendimiento √≥ptimo.", Precio:25},
  {Tipo:"5W20", Marca:"Pennzoil", Descripcion:"Mantiene el motor limpio y eficiente, buena resistencia t√©rmica.", Precio:24},
  {Tipo:"5W20", Marca:"Valvoline", Descripcion:"Buena durabilidad del motor, ideal para condiciones mixtas.", Precio:26},
  {Tipo:"5W30", Marca:"Mobil 1", Descripcion:"Excelente control de oxidaci√≥n y protecci√≥n del motor.", Precio:26},
  {Tipo:"5W30", Marca:"Pennzoil", Descripcion:"Alta limpieza y fluidez a bajas temperaturas.", Precio:25},
  {Tipo:"5W30", Marca:"Valvoline", Descripcion:"Aceite duradero con aditivos anti-desgaste avanzados.", Precio:27},
];
const selectTipo = document.getElementById('selectTipoAceite');
const selectMarca = document.getElementById('selectMarca');
const descArea = document.getElementById('descripcionAceite');

selectTipo.addEventListener('change', () => {
  const tipo = selectTipo.value;
  selectMarca.innerHTML = '<option value="">Selecciona marca de aceite</option>';
  descArea.value = "";
  if(!tipo) return;
  const marcas = aceitesData.filter(a => a.Tipo === tipo).map(a => a.Marca);
  marcas.forEach(m => {const opt = document.createElement('option'); opt.value=m; opt.textContent=m; selectMarca.appendChild(opt);});
});
selectMarca.addEventListener('change', () => {
  const tipo = selectTipo.value; const marca = selectMarca.value;
  const aceite = aceitesData.find(a => a.Tipo===tipo && a.Marca===marca);
  descArea.value = aceite ? aceite.Descripcion : "";
});

// Env√≠o del formulario
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw1Odn29AKsvgYwgnTpg3dNWczFmzj_fxQWpHQ2451W62eCgFf8Oqfu8CVo8RPYM8ygnw/exec"; 
document.getElementById('formCita').addEventListener('submit', function(e){
  e.preventDefault();
  const form = e.target; const msg = document.getElementById('mensaje');
  msg.textContent = "‚è≥ Enviando...";
  if(localStorage.getItem('acuerdoFirmado')!=='true'){msg.textContent={'es':'Debes leer y aceptar el acuerdo antes de enviar la cita.','en':'You must sign the agreement before submitting the booking.','pt':'Voc√™ deve assinar o acordo antes de enviar a reserva.'}[lang]; return;}
  const data = Object.fromEntries(new FormData(form).entries());
  const now = new Date(); const selected = new Date(data.Fecha+"T"+data.Hora);
  if(!data.Fecha || !data.Hora || selected-now<24*60*60*1000){msg.textContent={'es':'‚ùå La cita debe agendarse con al menos 24 horas de anticipaci√≥n','en':'‚ùå Appointments must be scheduled at least 24 hours in advance','pt':'‚ùå As reservas devem ser feitas com pelo menos 24 horas de anteced√™ncia'}[lang]; return;}
  const aceiteSel = aceitesData.find(a=>a.Tipo===data.TipoAceite && a.Marca===data.Marca); if(aceiteSel) data.PrecioAceite=aceiteSel.Precio;
  const cbName="cb_"+Date.now()+"_"+Math.floor(Math.random()*10000);
  window[cbName]=function(response){
    try{
      if(response && response.success){
        msg.textContent={'es':'‚úÖ Tu cita ha sido registrada correctamente','en':'‚úÖ Your appointment has been successfully booked','pt':'‚úÖ Sua reserva foi registrada com sucesso'}[lang];
        document.getElementById('reciboNombre').innerText=data.Nombre;
        document.getElementById('reciboTelefono').innerText=data.Telefono;
        document.getElementById('reciboCorreo').innerText=data.Correo;
        document.getElementById('reciboMarca').innerText=data.Marca;
        document.getElementById('reciboModelo').innerText=data.Modelo;
        document.getElementById('reciboAno').innerText=data.Ano;
        document.getElementById('reciboAceite').innerText=`${data.TipoAceite} - ${data.Marca}`;
        document.getElementById('reciboDireccion').innerText=data.Direccion;
        document.getElementById('reciboFecha').innerText=data.Fecha;
        document.getElementById('reciboHora').innerText=data.Hora;
        document.getElementById('reciboComentarios').innerText=data.Comentarios;
        document.getElementById('reciboFirma').innerText=data.Firma;
        document.getElementById('recibo').style.display="block";
        form.reset(); descArea.value="";
      } else {msg.textContent="‚ö†Ô∏è "+(response.error || "Error al registrar la cita");}
    } finally {const s=document.getElementById(cbName+"_script"); if(s && s.parentNode) s.parentNode.removeChild(s); delete window[cbName];}
  };
  const qs=new URLSearchParams(data); qs.append("callback",cbName);
  const script=document.createElement('script'); script.src=SCRIPT_URL+"?"+qs.toString(); script.id=cbName+"_script";
  script.onerror=function(){msg.textContent="‚ö†Ô∏è Error de conexi√≥n al servidor"; if(script.parentNode) script.parentNode.removeChild(script); delete window[cbName];};
  document.body.appendChild(script);
});
</script>
</body>
</html>
