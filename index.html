<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reserva - Cambio de Aceite</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f5f5f5; }
    .container { max-width: 650px; margin: 30px auto; background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #0b5ed7; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-top: 5px; }
    button { background-color: #0b5ed7; color: white; padding: 12px 18px; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%; font-size: 16px; }
    button:hover { background-color: #094bb7; }
    .check-section { margin-top: 20px; background: #f9f9f9; padding: 10px 15px; border-radius: 8px; border: 1px solid #ddd; }
    .check-section a { color: #0b5ed7; font-weight: 600; text-decoration: none; }
    .check-section a:hover { text-decoration: underline; }
    .firma { margin-top: 20px; }
  </style>
</head>
<body>

<div class="container">
  <h2>Reserva de Cambio de Aceite</h2>

  <form id="formReserva">
    <label>Nombre</label>
    <input type="text" name="Nombre" required>

    <label>Tel√©fono</label>
    <input type="tel" name="Telefono" required>

    <label>Correo</label>
    <input type="email" name="Correo" required>

    <label>Marca</label>
    <input type="text" name="Marca">

    <label>Modelo</label>
    <input type="text" name="Modelo">

    <label>A√±o</label>
    <input type="text" name="Ano">

    <label>Tipo de Aceite</label>
    <select name="TipoAceite" required>
      <option value="">Seleccionar...</option>
      <option>0W20</option>
      <option>5W20</option>
      <option>0W30</option>
      <option>5W30</option>
    </select>

    <label>Direcci√≥n</label>
    <textarea name="Direccion" rows="2" required></textarea>

    <label>Fecha</label>
    <input type="date" name="Fecha" required>

    <label>Hora</label>
    <input type="time" name="Hora" required>

    <label>Comentarios</label>
    <textarea name="Comentarios" rows="3"></textarea>

    <!-- Firma digital -->
    <div class="firma">
      <label>Escriba su nombre como firma digital ‚úçÔ∏è</label>
      <input type="text" name="Firma" id="firmaInput" required>
    </div>

    <!-- Acuerdo -->
    <div class="check-section">
      <input type="checkbox" id="checkAcuerdo" disabled required>
      <label for="checkAcuerdo">
        He le√≠do y acepto los <a href="acuerdo.html" target="_blank" id="btnVerAcuerdo">T√©rminos del Servicio</a>.
      </label>
    </div>

    <button type="submit">Enviar Reserva</button>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const check = document.getElementById("checkAcuerdo");
  const btnVerAcuerdo = document.getElementById("btnVerAcuerdo");

  // Verifica si ya se firm√≥ el acuerdo (desde localStorage)
  if (localStorage.getItem("acuerdoFirmado") === "true") {
    check.disabled = false;
  }

  // Al hacer clic en el enlace de acuerdo
  btnVerAcuerdo.addEventListener("click", () => {
    localStorage.removeItem("acuerdoFirmado"); // limpia estado previo
    setTimeout(() => {
      alert("üìù Lea y acepte el acuerdo en la nueva ventana. Luego vuelva aqu√≠ para continuar.");
    }, 200);
  });

  // Impide marcar el checkbox sin haber aceptado el acuerdo
  check.addEventListener("click", (e) => {
    if (check.disabled) {
      e.preventDefault();
      alert("Debe leer y aceptar el acuerdo antes de marcar esta casilla.");
      return false;
    }
  });

  // Cuando vuelve al index, si ya acept√≥, habilita el check
  window.addEventListener("focus", () => {
    if (localStorage.getItem("acuerdoFirmado") === "true") {
      check.disabled = false;
    }
  });

  // Enviar formulario
  document.getElementById("formReserva").addEventListener("submit", async (e) => {
    e.preventDefault();

    if (check.disabled || !check.checked) {
      alert("Debe aceptar los t√©rminos del servicio antes de continuar.");
      return;
    }

    const form = e.target;
    const data = new URLSearchParams(new FormData(form)).toString();
    const url = "https://script.google.com/macros/s/AKfycbxcI6GNX0ah3aphHVToNsTTBfRki7awGc87nu0-Pklz34WGZ4A_mnYOy2ktvVSUb7Cpdw/exec" + "?" + data;

    const res = await fetch(url);
    const json = await res.text();
    alert("‚úÖ Reserva enviada correctamente");
    form.reset();
    localStorage.removeItem("acuerdoFirmado");
    check.disabled = true;
    check.checked = false;
  });
});
</script>

</body>
</html>
